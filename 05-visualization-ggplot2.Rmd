---
layout: topic
title: Data visualization with ggplot2
subtitle: Visualizing data in R with the ggplot2 package
minutes: 60
---

```{r, echo=FALSE, purl=FALSE}
knitr::opts_chunk$set(fig.keep='last')
```

```{r setup, echo=FALSE, purl=FALSE}
source("setup.R")
```

> ### Learning Objectives
>
> - Visualize data using base R
> -	Visualize the same plot using R ggplot2 package
> -	Build step-by-step complex plots with the ggplot2 package

For more details and additional tutorials on using ggplot2, see the [official documentation](http://docs.ggplot2.org/current/).

Load required packages.

```{r}
library(dplyr)
library(ggplot2)
```

Load traffic data.

```{r}
pop <- readr::read_csv("http://www2.census.gov/geo/docs/reference/cenpop2010/county/CenPop2010_Mean_CO08.txt")
```

These data contain population and population center points for all the counties
in the state of Colorado.

## Base plotting 
Make a simple scatter plot of `hindfoot_length` (in millimeters) as a function
of `weight` (in grams), using basic R plotting capabilities.

```{r base-hist}
hist(x = pop$POPULATION)
```

Or how about a simple scatter plot of latitude and longitude, using basic R
plotting capabilities.

```{r base-plot}
plot(x = pop$LONGITUDE, y = pop$LATITUDE)
```

## Plotting with ggplot2
We will make the same two plots using the `ggplot2` package. `ggplot2` is a
plotting package that makes it simple to create complex plots from data in a
dataframe. It uses default settings, which help create publication quality
plots with a minimal amount of settings and tweaking.

`ggplot2` graphics are built step by step by adding new elements.

To build a ggplot we need to:

1. Bind the plot to a specific data frame using the `data` argument.
```{r, eval=FALSE}
ggplot(data = pop)
```

2. Define aesthetics (`aes`), which maps variables in the data to axes on the
plot or to plotting size, shape color, etc.
```{r, eval=FALSE}
ggplot(data = pop, aes(x = POPULATION))
```

3. Add `geoms`, which define the graphical representation of the data in the
plot (points, lines, bars). To add a geom to the plot use `+` operator. Anything
you put in the `ggplot()` function can be seen by any geom layers that you add.
```{r first-ggplot}
ggplot(data = pop, aes(x = POPULATION)) +
  geom_histogram()
```

4. Add better labeling.
```{r first-ggplot}
library(scales)
ggplot(data = pop, aes(x = POPULATION)) +
  geom_histogram() +
  scale_x_continuous(labels = comma) +
  labs(title = 'County Population in Colorado',
       x = 'Population',
       y = 'Count')
```

Let's try the scatterplot.
```{r second-ggplot}
ggplot(data = pop, aes(x = LONGITUDE, y = LATITUDE)) +
  geom_point() +
  coord_equal()
```

Usually plots with white background looks more readable in the publications.
We can set the background to white using the function `theme_bw()`.

```{r facet-by-species-and-sex-white-bg}
ggplot(data = pop, aes(x = LONGITUDE, y = LATITUDE)) +
  geom_point() +
  coord_equal() +
  theme_bw()
```

Sometimes adding color and transparency adds meaning to the plot.

```{r adding-colors}
ggplot(data = pop, aes(x = LONGITUDE, y = LATITUDE)) +
  geom_point(alpha = 0.1, color = "blue")
```


## Faceting
`ggplot2` has a special technique called *faceting* that allows to split one
plot into multiple plots based on some factor. 

```{r first-facet}
ggplot(data = yearly_counts, aes(x = year, y = n, color = species_id)) +
  geom_line() + 
  facet_wrap(~species_id)
```


Here are some ideas:

* See if you can change thickness of the lines.
* Can you find a way to change the name of the legend?
What about its labels?
* Use different color palette to improve the look
(http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/)

Enjoy plotting with ggplot2!
